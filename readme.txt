code from: https://github.com/cesanta/mongoose